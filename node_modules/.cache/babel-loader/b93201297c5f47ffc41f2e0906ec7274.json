{"ast":null,"code":"\"use strict\";\n\n// Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function () {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WalletLinkRelay = void 0;\nconst bind_decorator_1 = __importDefault(require(\"bind-decorator\"));\nconst crypto_1 = __importDefault(require(\"crypto\"));\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst WalletLinkConnection_1 = require(\"../connection/WalletLinkConnection\");\nconst util_1 = require(\"../util\");\nconst aes256gcm = __importStar(require(\"./aes256gcm\"));\nconst Session_1 = require(\"./Session\");\nconst Web3Method_1 = require(\"./Web3Method\");\nconst Web3RequestCanceledMessage_1 = require(\"./Web3RequestCanceledMessage\");\nconst Web3RequestMessage_1 = require(\"./Web3RequestMessage\");\nconst Web3Response_1 = require(\"./Web3Response\");\nconst Web3ResponseMessage_1 = require(\"./Web3ResponseMessage\");\nconst WalletLinkRelayAbstract_1 = require(\"./WalletLinkRelayAbstract\");\nclass WalletLinkRelay {\n  constructor(options) {\n    this.chainIdCallback = null;\n    this.jsonRpcUrlCallback = null;\n    this.appName = \"\";\n    this.appLogoUrl = null;\n    this.walletLinkUrl = options.walletLinkUrl;\n    this.storage = options.storage;\n    this.session = Session_1.Session.load(options.storage) || new Session_1.Session(options.storage).save();\n    this.relayEventManager = options.relayEventManager;\n    this.connection = new WalletLinkConnection_1.WalletLinkConnection(this.session.id, this.session.key, this.walletLinkUrl);\n    this.connection.incomingEvent$.pipe(operators_1.filter(m => m.event === \"Web3Response\")).subscribe({\n      next: this.handleIncomingEvent\n    });\n    // if session is marked destroyed, reset and reload\n    this.connection.sessionConfig$.pipe(operators_1.filter(c => !!c.metadata && c.metadata.__destroyed === \"1\")).subscribe({\n      next: this.resetAndReload\n    });\n    this.connection.sessionConfig$.pipe(operators_1.filter(c => c.metadata && c.metadata.WalletUsername !== undefined)).pipe(operators_1.map(c => aes256gcm.decrypt(c.metadata.WalletUsername, this.session.secret))).subscribe({\n      next: walletUsername => {\n        this.storage.setItem(WalletLinkRelayAbstract_1.WALLET_USER_NAME_KEY, walletUsername);\n      }\n    });\n    this.connection.sessionConfig$.pipe(operators_1.filter(c => c.metadata && c.metadata.ChainId !== undefined)).pipe(operators_1.map(c => aes256gcm.decrypt(c.metadata.ChainId, this.session.secret))).pipe(operators_1.distinctUntilChanged()).subscribe({\n      next: chainId => {\n        if (this.chainIdCallback) {\n          this.chainIdCallback(chainId);\n        }\n      }\n    });\n    this.connection.sessionConfig$.pipe(operators_1.filter(c => c.metadata && c.metadata.JsonRpcUrl !== undefined)).pipe(operators_1.map(c => aes256gcm.decrypt(c.metadata.JsonRpcUrl, this.session.secret))).pipe(operators_1.distinctUntilChanged()).subscribe({\n      next: jsonRpcURl => {\n        if (this.jsonRpcUrlCallback) {\n          this.jsonRpcUrlCallback(jsonRpcURl);\n        }\n      }\n    });\n    this.ui = options.walletLinkUIConstructor({\n      walletLinkUrl: options.walletLinkUrl,\n      version: options.version,\n      darkMode: options.darkMode,\n      session: this.session,\n      connected$: this.connection.connected$\n    });\n    this.connection.connect();\n  }\n  attachUI() {\n    this.ui.attach();\n  }\n  resetAndReload() {\n    this.connection.setSessionMetadata(\"__destroyed\", \"1\").pipe(operators_1.timeout(1000), operators_1.catchError(_ => rxjs_1.of(null))).subscribe(_ => {\n      this.connection.destroy();\n      this.storage.clear();\n      this.ui.reloadUI();\n    });\n  }\n  setAppInfo(appName, appLogoUrl) {\n    this.appName = appName;\n    this.appLogoUrl = appLogoUrl;\n  }\n  getStorageItem(key) {\n    return this.storage.getItem(key);\n  }\n  setStorageItem(key, value) {\n    this.storage.setItem(key, value);\n  }\n  childRequestEthereumAccounts(childSessionId, childSessionSecret, dappName, dappLogoURL, dappURL) {\n    return this.sendRequest({\n      method: Web3Method_1.Web3Method.childRequestEthereumAccounts,\n      params: {\n        sessionId: childSessionId,\n        sessionSecret: childSessionSecret,\n        appName: dappName,\n        appLogoURL: dappLogoURL,\n        appURL: dappURL\n      }\n    });\n  }\n  requestEthereumAccounts() {\n    return this.sendRequest({\n      method: Web3Method_1.Web3Method.requestEthereumAccounts,\n      params: {\n        appName: this.appName,\n        appLogoUrl: this.appLogoUrl || null\n      }\n    });\n  }\n  signEthereumMessage(message, address, addPrefix, typedDataJson) {\n    return this.sendRequest({\n      method: Web3Method_1.Web3Method.signEthereumMessage,\n      params: {\n        message: util_1.hexStringFromBuffer(message, true),\n        address,\n        addPrefix,\n        typedDataJson: typedDataJson || null\n      }\n    });\n  }\n  ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n    return this.sendRequest({\n      method: Web3Method_1.Web3Method.ethereumAddressFromSignedMessage,\n      params: {\n        message: util_1.hexStringFromBuffer(message, true),\n        signature: util_1.hexStringFromBuffer(signature, true),\n        addPrefix\n      }\n    });\n  }\n  signEthereumTransaction(params) {\n    return this.sendRequest({\n      method: Web3Method_1.Web3Method.signEthereumTransaction,\n      params: {\n        fromAddress: params.fromAddress,\n        toAddress: params.toAddress,\n        weiValue: util_1.bigIntStringFromBN(params.weiValue),\n        data: util_1.hexStringFromBuffer(params.data, true),\n        nonce: params.nonce,\n        gasPriceInWei: params.gasPriceInWei ? util_1.bigIntStringFromBN(params.gasPriceInWei) : null,\n        gasLimit: params.gasLimit ? util_1.bigIntStringFromBN(params.gasLimit) : null,\n        chainId: params.chainId,\n        shouldSubmit: false\n      }\n    });\n  }\n  signAndSubmitEthereumTransaction(params) {\n    return this.sendRequest({\n      method: Web3Method_1.Web3Method.signEthereumTransaction,\n      params: {\n        fromAddress: params.fromAddress,\n        toAddress: params.toAddress,\n        weiValue: util_1.bigIntStringFromBN(params.weiValue),\n        data: util_1.hexStringFromBuffer(params.data, true),\n        nonce: params.nonce,\n        gasPriceInWei: params.gasPriceInWei ? util_1.bigIntStringFromBN(params.gasPriceInWei) : null,\n        gasLimit: params.gasLimit ? util_1.bigIntStringFromBN(params.gasLimit) : null,\n        chainId: params.chainId,\n        shouldSubmit: true\n      }\n    });\n  }\n  submitEthereumTransaction(signedTransaction, chainId) {\n    return this.sendRequest({\n      method: Web3Method_1.Web3Method.submitEthereumTransaction,\n      params: {\n        signedTransaction: util_1.hexStringFromBuffer(signedTransaction, true),\n        chainId\n      }\n    });\n  }\n  scanQRCode(regExp) {\n    return this.sendRequest({\n      method: Web3Method_1.Web3Method.scanQRCode,\n      params: {\n        regExp\n      }\n    });\n  }\n  arbitraryRequest(data) {\n    return this.sendRequest({\n      method: Web3Method_1.Web3Method.arbitrary,\n      params: {\n        data\n      }\n    });\n  }\n  sendRequest(request) {\n    return new Promise((resolve, reject) => {\n      var _a;\n      let hideSnackbarItem = null;\n      const id = crypto_1.default.randomBytes(8).toString(\"hex\");\n      const isRequestAccounts = request.method === Web3Method_1.Web3Method.requestEthereumAccounts;\n      const cancel = () => {\n        this.publishWeb3RequestCanceledEvent(id);\n        this.handleWeb3ResponseMessage(Web3ResponseMessage_1.Web3ResponseMessage({\n          id,\n          response: Web3Response_1.ErrorResponse(request.method, \"User rejected request\")\n        }));\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n      };\n      if (isRequestAccounts) {\n        const userAgent = ((_a = window === null || window === void 0 ? void 0 : window.navigator) === null || _a === void 0 ? void 0 : _a.userAgent) || null;\n        if (userAgent && /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {\n          const dappUrl = window.location.href.split(\"?\")[0];\n          window.location.href = `https://go.cb-w.com/xoXnYwQimhb?cb_url=${dappUrl}`;\n          return;\n        }\n        if (this.ui.inlineAccountsResponse()) {\n          const onAccounts = accounts => {\n            this.handleWeb3ResponseMessage(Web3ResponseMessage_1.Web3ResponseMessage({\n              id,\n              response: Web3Response_1.RequestEthereumAccountsResponse(accounts)\n            }));\n          };\n          this.ui.requestEthereumAccounts({\n            onCancel: cancel,\n            onAccounts: onAccounts\n          });\n        } else {\n          this.ui.requestEthereumAccounts({\n            onCancel: cancel\n          });\n        }\n        WalletLinkRelay.accountRequestCallbackIds.add(id);\n      } else {\n        hideSnackbarItem = this.ui.showConnecting({\n          onCancel: cancel,\n          onResetConnection: this.resetAndReload\n        });\n      }\n      this.relayEventManager.callbacks.set(id, response => {\n        this.ui.hideRequestEthereumAccounts();\n        hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n        if (response.errorMessage) {\n          return reject(new Error(response.errorMessage));\n        }\n        resolve(response);\n      });\n      if (!isRequestAccounts || !this.ui.inlineAccountsResponse()) {\n        this.publishWeb3RequestEvent(id, request);\n      }\n    });\n  }\n  setConnectDisabled(disabled) {\n    this.ui.setConnectDisabled(disabled);\n  }\n  setChainIdCallback(chainIdCallback) {\n    this.chainIdCallback = chainIdCallback;\n  }\n  setJsonRpcUrlCallback(jsonRpcUrlCallback) {\n    this.jsonRpcUrlCallback = jsonRpcUrlCallback;\n  }\n  publishWeb3RequestEvent(id, request) {\n    const message = Web3RequestMessage_1.Web3RequestMessage({\n      id,\n      request\n    });\n    this.publishEvent(\"Web3Request\", message, true).subscribe({\n      error: err => {\n        this.handleWeb3ResponseMessage(Web3ResponseMessage_1.Web3ResponseMessage({\n          id: message.id,\n          response: {\n            method: message.request.method,\n            errorMessage: err.message\n          }\n        }));\n      }\n    });\n  }\n  publishWeb3RequestCanceledEvent(id) {\n    const message = Web3RequestCanceledMessage_1.Web3RequestCanceledMessage(id);\n    this.publishEvent(\"Web3RequestCanceled\", message, false).subscribe();\n  }\n  publishEvent(event, message, callWebhook) {\n    const encrypted = aes256gcm.encrypt(JSON.stringify(Object.assign(Object.assign({}, message), {\n      origin: location.origin\n    })), this.session.secret);\n    return this.connection.publishEvent(event, encrypted, callWebhook);\n  }\n  handleIncomingEvent(event) {\n    let json;\n    try {\n      json = JSON.parse(aes256gcm.decrypt(event.data, this.session.secret));\n    } catch (_a) {\n      return;\n    }\n    const message = Web3ResponseMessage_1.isWeb3ResponseMessage(json) ? json : null;\n    if (!message) {\n      return;\n    }\n    this.handleWeb3ResponseMessage(message);\n  }\n  handleWeb3ResponseMessage(message) {\n    const {\n      response\n    } = message;\n    if (Web3Response_1.isRequestEthereumAccountsResponse(response)) {\n      Array.from(WalletLinkRelay.accountRequestCallbackIds.values()).forEach(id => this.invokeCallback(Object.assign(Object.assign({}, message), {\n        id\n      })));\n      WalletLinkRelay.accountRequestCallbackIds.clear();\n      return;\n    }\n    this.invokeCallback(message);\n  }\n  invokeCallback(message) {\n    const callback = this.relayEventManager.callbacks.get(message.id);\n    if (callback) {\n      callback(message.response);\n      this.relayEventManager.callbacks.delete(message.id);\n    }\n  }\n}\nWalletLinkRelay.accountRequestCallbackIds = new Set();\n__decorate([bind_decorator_1.default], WalletLinkRelay.prototype, \"resetAndReload\", null);\n__decorate([bind_decorator_1.default], WalletLinkRelay.prototype, \"handleIncomingEvent\", null);\nexports.WalletLinkRelay = WalletLinkRelay;","map":{"version":3,"names":["__createBinding","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","d","Reflect","decorate","i","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","__importDefault","exports","WalletLinkRelay","bind_decorator_1","require","crypto_1","rxjs_1","operators_1","WalletLinkConnection_1","util_1","aes256gcm","Session_1","Web3Method_1","Web3RequestCanceledMessage_1","Web3RequestMessage_1","Web3Response_1","Web3ResponseMessage_1","WalletLinkRelayAbstract_1","constructor","options","chainIdCallback","jsonRpcUrlCallback","appName","appLogoUrl","walletLinkUrl","storage","session","Session","load","save","relayEventManager","connection","WalletLinkConnection","id","incomingEvent$","pipe","filter","event","subscribe","next","handleIncomingEvent","sessionConfig$","metadata","__destroyed","resetAndReload","WalletUsername","map","decrypt","secret","walletUsername","setItem","WALLET_USER_NAME_KEY","ChainId","distinctUntilChanged","chainId","JsonRpcUrl","jsonRpcURl","ui","walletLinkUIConstructor","version","darkMode","connected$","connect","attachUI","attach","setSessionMetadata","timeout","catchError","_","of","destroy","clear","reloadUI","setAppInfo","getStorageItem","getItem","setStorageItem","childRequestEthereumAccounts","childSessionId","childSessionSecret","dappName","dappLogoURL","dappURL","sendRequest","method","Web3Method","params","sessionId","sessionSecret","appLogoURL","appURL","requestEthereumAccounts","signEthereumMessage","message","address","addPrefix","typedDataJson","hexStringFromBuffer","ethereumAddressFromSignedMessage","signature","signEthereumTransaction","fromAddress","toAddress","weiValue","bigIntStringFromBN","data","nonce","gasPriceInWei","gasLimit","shouldSubmit","signAndSubmitEthereumTransaction","submitEthereumTransaction","signedTransaction","scanQRCode","regExp","arbitraryRequest","arbitrary","request","Promise","resolve","reject","_a","hideSnackbarItem","default","randomBytes","toString","isRequestAccounts","cancel","publishWeb3RequestCanceledEvent","handleWeb3ResponseMessage","Web3ResponseMessage","response","ErrorResponse","userAgent","window","navigator","test","dappUrl","location","href","split","inlineAccountsResponse","onAccounts","accounts","RequestEthereumAccountsResponse","onCancel","accountRequestCallbackIds","add","showConnecting","onResetConnection","callbacks","set","hideRequestEthereumAccounts","errorMessage","Error","publishWeb3RequestEvent","setConnectDisabled","disabled","setChainIdCallback","setJsonRpcUrlCallback","Web3RequestMessage","publishEvent","error","err","Web3RequestCanceledMessage","callWebhook","encrypted","encrypt","JSON","stringify","assign","origin","json","parse","isWeb3ResponseMessage","isRequestEthereumAccountsResponse","Array","from","values","forEach","invokeCallback","callback","delete","Set"],"sources":["/Users/radioactivedevil08/Polygon/starter-kits/node_modules/walletlink/dist/relay/WalletLinkRelay.js"],"sourcesContent":["\"use strict\";\n// Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.WalletLinkRelay = void 0;\nconst bind_decorator_1 = __importDefault(require(\"bind-decorator\"));\nconst crypto_1 = __importDefault(require(\"crypto\"));\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst WalletLinkConnection_1 = require(\"../connection/WalletLinkConnection\");\nconst util_1 = require(\"../util\");\nconst aes256gcm = __importStar(require(\"./aes256gcm\"));\nconst Session_1 = require(\"./Session\");\nconst Web3Method_1 = require(\"./Web3Method\");\nconst Web3RequestCanceledMessage_1 = require(\"./Web3RequestCanceledMessage\");\nconst Web3RequestMessage_1 = require(\"./Web3RequestMessage\");\nconst Web3Response_1 = require(\"./Web3Response\");\nconst Web3ResponseMessage_1 = require(\"./Web3ResponseMessage\");\nconst WalletLinkRelayAbstract_1 = require(\"./WalletLinkRelayAbstract\");\nclass WalletLinkRelay {\n    constructor(options) {\n        this.chainIdCallback = null;\n        this.jsonRpcUrlCallback = null;\n        this.appName = \"\";\n        this.appLogoUrl = null;\n        this.walletLinkUrl = options.walletLinkUrl;\n        this.storage = options.storage;\n        this.session =\n            Session_1.Session.load(options.storage) || new Session_1.Session(options.storage).save();\n        this.relayEventManager = options.relayEventManager;\n        this.connection = new WalletLinkConnection_1.WalletLinkConnection(this.session.id, this.session.key, this.walletLinkUrl);\n        this.connection.incomingEvent$\n            .pipe(operators_1.filter(m => m.event === \"Web3Response\"))\n            .subscribe({ next: this.handleIncomingEvent });\n        // if session is marked destroyed, reset and reload\n        this.connection.sessionConfig$\n            .pipe(operators_1.filter(c => !!c.metadata && c.metadata.__destroyed === \"1\"))\n            .subscribe({ next: this.resetAndReload });\n        this.connection.sessionConfig$\n            .pipe(operators_1.filter(c => c.metadata && c.metadata.WalletUsername !== undefined))\n            .pipe(operators_1.map(c => aes256gcm.decrypt(c.metadata.WalletUsername, this.session.secret)))\n            .subscribe({\n            next: walletUsername => {\n                this.storage.setItem(WalletLinkRelayAbstract_1.WALLET_USER_NAME_KEY, walletUsername);\n            }\n        });\n        this.connection.sessionConfig$\n            .pipe(operators_1.filter(c => c.metadata && c.metadata.ChainId !== undefined))\n            .pipe(operators_1.map(c => aes256gcm.decrypt(c.metadata.ChainId, this.session.secret)))\n            .pipe(operators_1.distinctUntilChanged())\n            .subscribe({ next: chainId => {\n                if (this.chainIdCallback) {\n                    this.chainIdCallback(chainId);\n                }\n            }\n        });\n        this.connection.sessionConfig$\n            .pipe(operators_1.filter(c => c.metadata && c.metadata.JsonRpcUrl !== undefined))\n            .pipe(operators_1.map(c => aes256gcm.decrypt(c.metadata.JsonRpcUrl, this.session.secret)))\n            .pipe(operators_1.distinctUntilChanged())\n            .subscribe({\n            next: jsonRpcURl => {\n                if (this.jsonRpcUrlCallback) {\n                    this.jsonRpcUrlCallback(jsonRpcURl);\n                }\n            },\n        });\n        this.ui = options.walletLinkUIConstructor({\n            walletLinkUrl: options.walletLinkUrl,\n            version: options.version,\n            darkMode: options.darkMode,\n            session: this.session,\n            connected$: this.connection.connected$\n        });\n        this.connection.connect();\n    }\n    attachUI() {\n        this.ui.attach();\n    }\n    resetAndReload() {\n        this.connection\n            .setSessionMetadata(\"__destroyed\", \"1\")\n            .pipe(operators_1.timeout(1000), operators_1.catchError(_ => rxjs_1.of(null)))\n            .subscribe(_ => {\n            this.connection.destroy();\n            this.storage.clear();\n            this.ui.reloadUI();\n        });\n    }\n    setAppInfo(appName, appLogoUrl) {\n        this.appName = appName;\n        this.appLogoUrl = appLogoUrl;\n    }\n    getStorageItem(key) {\n        return this.storage.getItem(key);\n    }\n    setStorageItem(key, value) {\n        this.storage.setItem(key, value);\n    }\n    childRequestEthereumAccounts(childSessionId, childSessionSecret, dappName, dappLogoURL, dappURL) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.childRequestEthereumAccounts,\n            params: {\n                sessionId: childSessionId,\n                sessionSecret: childSessionSecret,\n                appName: dappName,\n                appLogoURL: dappLogoURL,\n                appURL: dappURL\n            }\n        });\n    }\n    requestEthereumAccounts() {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.requestEthereumAccounts,\n            params: {\n                appName: this.appName,\n                appLogoUrl: this.appLogoUrl || null\n            }\n        });\n    }\n    signEthereumMessage(message, address, addPrefix, typedDataJson) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumMessage,\n            params: {\n                message: util_1.hexStringFromBuffer(message, true),\n                address,\n                addPrefix,\n                typedDataJson: typedDataJson || null\n            }\n        });\n    }\n    ethereumAddressFromSignedMessage(message, signature, addPrefix) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.ethereumAddressFromSignedMessage,\n            params: {\n                message: util_1.hexStringFromBuffer(message, true),\n                signature: util_1.hexStringFromBuffer(signature, true),\n                addPrefix\n            }\n        });\n    }\n    signEthereumTransaction(params) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumTransaction,\n            params: {\n                fromAddress: params.fromAddress,\n                toAddress: params.toAddress,\n                weiValue: util_1.bigIntStringFromBN(params.weiValue),\n                data: util_1.hexStringFromBuffer(params.data, true),\n                nonce: params.nonce,\n                gasPriceInWei: params.gasPriceInWei\n                    ? util_1.bigIntStringFromBN(params.gasPriceInWei)\n                    : null,\n                gasLimit: params.gasLimit ? util_1.bigIntStringFromBN(params.gasLimit) : null,\n                chainId: params.chainId,\n                shouldSubmit: false\n            }\n        });\n    }\n    signAndSubmitEthereumTransaction(params) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.signEthereumTransaction,\n            params: {\n                fromAddress: params.fromAddress,\n                toAddress: params.toAddress,\n                weiValue: util_1.bigIntStringFromBN(params.weiValue),\n                data: util_1.hexStringFromBuffer(params.data, true),\n                nonce: params.nonce,\n                gasPriceInWei: params.gasPriceInWei\n                    ? util_1.bigIntStringFromBN(params.gasPriceInWei)\n                    : null,\n                gasLimit: params.gasLimit ? util_1.bigIntStringFromBN(params.gasLimit) : null,\n                chainId: params.chainId,\n                shouldSubmit: true\n            }\n        });\n    }\n    submitEthereumTransaction(signedTransaction, chainId) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.submitEthereumTransaction,\n            params: {\n                signedTransaction: util_1.hexStringFromBuffer(signedTransaction, true),\n                chainId\n            }\n        });\n    }\n    scanQRCode(regExp) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.scanQRCode,\n            params: { regExp }\n        });\n    }\n    arbitraryRequest(data) {\n        return this.sendRequest({\n            method: Web3Method_1.Web3Method.arbitrary,\n            params: { data }\n        });\n    }\n    sendRequest(request) {\n        return new Promise((resolve, reject) => {\n            var _a;\n            let hideSnackbarItem = null;\n            const id = crypto_1.default.randomBytes(8).toString(\"hex\");\n            const isRequestAccounts = request.method === Web3Method_1.Web3Method.requestEthereumAccounts;\n            const cancel = () => {\n                this.publishWeb3RequestCanceledEvent(id);\n                this.handleWeb3ResponseMessage(Web3ResponseMessage_1.Web3ResponseMessage({\n                    id,\n                    response: Web3Response_1.ErrorResponse(request.method, \"User rejected request\")\n                }));\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n            };\n            if (isRequestAccounts) {\n                const userAgent = ((_a = window === null || window === void 0 ? void 0 : window.navigator) === null || _a === void 0 ? void 0 : _a.userAgent) || null;\n                if (userAgent &&\n                    /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {\n                    const dappUrl = window.location.href.split(\"?\")[0];\n                    window.location.href = `https://go.cb-w.com/xoXnYwQimhb?cb_url=${dappUrl}`;\n                    return;\n                }\n                if (this.ui.inlineAccountsResponse()) {\n                    const onAccounts = (accounts) => {\n                        this.handleWeb3ResponseMessage(Web3ResponseMessage_1.Web3ResponseMessage({\n                            id,\n                            response: Web3Response_1.RequestEthereumAccountsResponse(accounts)\n                        }));\n                    };\n                    this.ui.requestEthereumAccounts({\n                        onCancel: cancel,\n                        onAccounts: onAccounts\n                    });\n                }\n                else {\n                    this.ui.requestEthereumAccounts({\n                        onCancel: cancel\n                    });\n                }\n                WalletLinkRelay.accountRequestCallbackIds.add(id);\n            }\n            else {\n                hideSnackbarItem = this.ui.showConnecting({\n                    onCancel: cancel,\n                    onResetConnection: this.resetAndReload\n                });\n            }\n            this.relayEventManager.callbacks.set(id, response => {\n                this.ui.hideRequestEthereumAccounts();\n                hideSnackbarItem === null || hideSnackbarItem === void 0 ? void 0 : hideSnackbarItem();\n                if (response.errorMessage) {\n                    return reject(new Error(response.errorMessage));\n                }\n                resolve(response);\n            });\n            if (!isRequestAccounts ||\n                !this.ui.inlineAccountsResponse()) {\n                this.publishWeb3RequestEvent(id, request);\n            }\n        });\n    }\n    setConnectDisabled(disabled) {\n        this.ui.setConnectDisabled(disabled);\n    }\n    setChainIdCallback(chainIdCallback) {\n        this.chainIdCallback = chainIdCallback;\n    }\n    setJsonRpcUrlCallback(jsonRpcUrlCallback) {\n        this.jsonRpcUrlCallback = jsonRpcUrlCallback;\n    }\n    publishWeb3RequestEvent(id, request) {\n        const message = Web3RequestMessage_1.Web3RequestMessage({ id, request });\n        this.publishEvent(\"Web3Request\", message, true).subscribe({\n            error: err => {\n                this.handleWeb3ResponseMessage(Web3ResponseMessage_1.Web3ResponseMessage({\n                    id: message.id,\n                    response: {\n                        method: message.request.method,\n                        errorMessage: err.message\n                    }\n                }));\n            }\n        });\n    }\n    publishWeb3RequestCanceledEvent(id) {\n        const message = Web3RequestCanceledMessage_1.Web3RequestCanceledMessage(id);\n        this.publishEvent(\"Web3RequestCanceled\", message, false).subscribe();\n    }\n    publishEvent(event, message, callWebhook) {\n        const encrypted = aes256gcm.encrypt(JSON.stringify(Object.assign(Object.assign({}, message), { origin: location.origin })), this.session.secret);\n        return this.connection.publishEvent(event, encrypted, callWebhook);\n    }\n    handleIncomingEvent(event) {\n        let json;\n        try {\n            json = JSON.parse(aes256gcm.decrypt(event.data, this.session.secret));\n        }\n        catch (_a) {\n            return;\n        }\n        const message = Web3ResponseMessage_1.isWeb3ResponseMessage(json) ? json : null;\n        if (!message) {\n            return;\n        }\n        this.handleWeb3ResponseMessage(message);\n    }\n    handleWeb3ResponseMessage(message) {\n        const { response } = message;\n        if (Web3Response_1.isRequestEthereumAccountsResponse(response)) {\n            Array.from(WalletLinkRelay.accountRequestCallbackIds.values()).forEach(id => this.invokeCallback(Object.assign(Object.assign({}, message), { id })));\n            WalletLinkRelay.accountRequestCallbackIds.clear();\n            return;\n        }\n        this.invokeCallback(message);\n    }\n    invokeCallback(message) {\n        const callback = this.relayEventManager.callbacks.get(message.id);\n        if (callback) {\n            callback(message.response);\n            this.relayEventManager.callbacks.delete(message.id);\n        }\n    }\n}\nWalletLinkRelay.accountRequestCallbackIds = new Set();\n__decorate([\n    bind_decorator_1.default\n], WalletLinkRelay.prototype, \"resetAndReload\", null);\n__decorate([\n    bind_decorator_1.default\n], WalletLinkRelay.prototype, \"handleIncomingEvent\", null);\nexports.WalletLinkRelay = WalletLinkRelay;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}