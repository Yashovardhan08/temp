{"ast":null,"code":"/** PURE_IMPORTS_START tslib,_Subject,_scheduler_async,_Subscriber,_util_isNumeric,_util_isScheduler PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { Subject } from '../Subject';\nimport { async } from '../scheduler/async';\nimport { Subscriber } from '../Subscriber';\nimport { isNumeric } from '../util/isNumeric';\nimport { isScheduler } from '../util/isScheduler';\nexport function windowTime(windowTimeSpan) {\n  var scheduler = async;\n  var windowCreationInterval = null;\n  var maxWindowSize = Number.POSITIVE_INFINITY;\n  if (isScheduler(arguments[3])) {\n    scheduler = arguments[3];\n  }\n  if (isScheduler(arguments[2])) {\n    scheduler = arguments[2];\n  } else if (isNumeric(arguments[2])) {\n    maxWindowSize = Number(arguments[2]);\n  }\n  if (isScheduler(arguments[1])) {\n    scheduler = arguments[1];\n  } else if (isNumeric(arguments[1])) {\n    windowCreationInterval = Number(arguments[1]);\n  }\n  return function windowTimeOperatorFunction(source) {\n    return source.lift(new WindowTimeOperator(windowTimeSpan, windowCreationInterval, maxWindowSize, scheduler));\n  };\n}\nvar WindowTimeOperator = /*@__PURE__*/function () {\n  function WindowTimeOperator(windowTimeSpan, windowCreationInterval, maxWindowSize, scheduler) {\n    this.windowTimeSpan = windowTimeSpan;\n    this.windowCreationInterval = windowCreationInterval;\n    this.maxWindowSize = maxWindowSize;\n    this.scheduler = scheduler;\n  }\n  WindowTimeOperator.prototype.call = function (subscriber, source) {\n    return source.subscribe(new WindowTimeSubscriber(subscriber, this.windowTimeSpan, this.windowCreationInterval, this.maxWindowSize, this.scheduler));\n  };\n  return WindowTimeOperator;\n}();\nvar CountedSubject = /*@__PURE__*/function (_super) {\n  tslib_1.__extends(CountedSubject, _super);\n  function CountedSubject() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n    _this._numberOfNextedValues = 0;\n    return _this;\n  }\n  CountedSubject.prototype.next = function (value) {\n    this._numberOfNextedValues++;\n    _super.prototype.next.call(this, value);\n  };\n  Object.defineProperty(CountedSubject.prototype, \"numberOfNextedValues\", {\n    get: function () {\n      return this._numberOfNextedValues;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return CountedSubject;\n}(Subject);\nvar WindowTimeSubscriber = /*@__PURE__*/function (_super) {\n  tslib_1.__extends(WindowTimeSubscriber, _super);\n  function WindowTimeSubscriber(destination, windowTimeSpan, windowCreationInterval, maxWindowSize, scheduler) {\n    var _this = _super.call(this, destination) || this;\n    _this.destination = destination;\n    _this.windowTimeSpan = windowTimeSpan;\n    _this.windowCreationInterval = windowCreationInterval;\n    _this.maxWindowSize = maxWindowSize;\n    _this.scheduler = scheduler;\n    _this.windows = [];\n    var window = _this.openWindow();\n    if (windowCreationInterval !== null && windowCreationInterval >= 0) {\n      var closeState = {\n        subscriber: _this,\n        window: window,\n        context: null\n      };\n      var creationState = {\n        windowTimeSpan: windowTimeSpan,\n        windowCreationInterval: windowCreationInterval,\n        subscriber: _this,\n        scheduler: scheduler\n      };\n      _this.add(scheduler.schedule(dispatchWindowClose, windowTimeSpan, closeState));\n      _this.add(scheduler.schedule(dispatchWindowCreation, windowCreationInterval, creationState));\n    } else {\n      var timeSpanOnlyState = {\n        subscriber: _this,\n        window: window,\n        windowTimeSpan: windowTimeSpan\n      };\n      _this.add(scheduler.schedule(dispatchWindowTimeSpanOnly, windowTimeSpan, timeSpanOnlyState));\n    }\n    return _this;\n  }\n  WindowTimeSubscriber.prototype._next = function (value) {\n    var windows = this.windows;\n    var len = windows.length;\n    for (var i = 0; i < len; i++) {\n      var window_1 = windows[i];\n      if (!window_1.closed) {\n        window_1.next(value);\n        if (window_1.numberOfNextedValues >= this.maxWindowSize) {\n          this.closeWindow(window_1);\n        }\n      }\n    }\n  };\n  WindowTimeSubscriber.prototype._error = function (err) {\n    var windows = this.windows;\n    while (windows.length > 0) {\n      windows.shift().error(err);\n    }\n    this.destination.error(err);\n  };\n  WindowTimeSubscriber.prototype._complete = function () {\n    var windows = this.windows;\n    while (windows.length > 0) {\n      var window_2 = windows.shift();\n      if (!window_2.closed) {\n        window_2.complete();\n      }\n    }\n    this.destination.complete();\n  };\n  WindowTimeSubscriber.prototype.openWindow = function () {\n    var window = new CountedSubject();\n    this.windows.push(window);\n    var destination = this.destination;\n    destination.next(window);\n    return window;\n  };\n  WindowTimeSubscriber.prototype.closeWindow = function (window) {\n    window.complete();\n    var windows = this.windows;\n    windows.splice(windows.indexOf(window), 1);\n  };\n  return WindowTimeSubscriber;\n}(Subscriber);\nfunction dispatchWindowTimeSpanOnly(state) {\n  var subscriber = state.subscriber,\n    windowTimeSpan = state.windowTimeSpan,\n    window = state.window;\n  if (window) {\n    subscriber.closeWindow(window);\n  }\n  state.window = subscriber.openWindow();\n  this.schedule(state, windowTimeSpan);\n}\nfunction dispatchWindowCreation(state) {\n  var windowTimeSpan = state.windowTimeSpan,\n    subscriber = state.subscriber,\n    scheduler = state.scheduler,\n    windowCreationInterval = state.windowCreationInterval;\n  var window = subscriber.openWindow();\n  var action = this;\n  var context = {\n    action: action,\n    subscription: null\n  };\n  var timeSpanState = {\n    subscriber: subscriber,\n    window: window,\n    context: context\n  };\n  context.subscription = scheduler.schedule(dispatchWindowClose, windowTimeSpan, timeSpanState);\n  action.add(context.subscription);\n  action.schedule(state, windowCreationInterval);\n}\nfunction dispatchWindowClose(state) {\n  var subscriber = state.subscriber,\n    window = state.window,\n    context = state.context;\n  if (context && context.action && context.subscription) {\n    context.action.remove(context.subscription);\n  }\n  subscriber.closeWindow(window);\n}","map":{"version":3,"mappings":"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","names":["tslib_1","Subject","async","Subscriber","isNumeric","isScheduler","windowTime","scheduler","windowCreationInterval","maxWindowSize","POSITIVE_INFINITY","arguments","windowTimeOperatorFunction","WindowTimeOperator","CountedSubject","_super","value","configurable","WindowTimeSubscriber","_this","destination","window","closeState","subscriber","context","windowTimeSpan","add","schedule","dispatchWindowClose","_next","windows","i","len","window_1","_error","_complete","window_2","prototype","dispatchWindowTimeSpanOnly","state","dispatchWindowCreation","action","subscription"],"sources":["../../../src/internal/operators/windowTime.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}